<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMDB Data Enricher - CINEMAF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .status-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 600;
        }
        
        .status-value {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 10px;
            border-radius: 5px;
        }
        
        .status-value.success {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .status-value.error {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .log-container {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #888;
            margin-right: 10px;
        }
        
        .log-success {
            color: #10b981;
        }
        
        .log-error {
            color: #ef4444;
        }
        
        .log-info {
            color: #3b82f6;
        }
        
        .log-warning {
            color: #f59e0b;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar.active {
            display: block;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            opacity: 0.8;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .processing {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ TMDB Data Enricher</h1>
        <p class="subtitle">Enrichissez automatiquement vos donn√©es de films avec l'API TMDB</p>
        
        <div class="status-box">
            <h3 style="margin-bottom: 15px;">üìä Status</h3>
            <div class="status-item">
                <span class="status-label">API TMDB</span>
                <span class="status-value" id="api-status">V√©rification...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Donn√©es charg√©es</span>
                <span class="status-value" id="data-status">V√©rification...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Total de films</span>
                <span class="status-value" id="total-movies">0</span>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn btn-success" onclick="startFullEnrichment()" id="btn-enrich">
                üöÄ Enrichir Tous os Dados
            </button>
            <button class="btn btn-info" onclick="showPreview()" id="btn-preview">
                üëÅÔ∏è Pr√©-visualiza√ß√£o
            </button>
            <button class="btn btn-warning" onclick="testSingleMovie()">
                üß™ Testar Um Filme
            </button>
            <button class="btn btn-primary" onclick="downloadSample()">
                üì• Baixar Exemplo
            </button>
        </div>
        
        <div class="progress-bar" id="progress-bar">
            <div class="progress-fill" id="progress-fill">0%</div>
        </div>
        
        <div class="stats-grid" id="stats-grid" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="stat-processed">0</div>
                <div class="stat-label">Processados</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-enriched">0</div>
                <div class="stat-label">Enrichidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-failed">0</div>
                <div class="stat-label">Falhados</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-success">0%</div>
                <div class="stat-label">Taxa de Sucesso</div>
            </div>
        </div>
        
        <div class="log-container" id="log-container">
            <div class="log-entry log-info">
                <span class="log-time">[Sistema]</span>
                Aguardando a√ß√£o do usu√°rio...
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="categories-data.js"></script>
    <script src="enrich-categories-data.js"></script>
    <script>
        // Variables globales
        let enrichedData = null;
        let stats = {
            processed: 0,
            enriched: 0,
            failed: 0,
            total: 0
        };
        
        // V√©rifier le status au chargement
        window.addEventListener('load', checkStatus);
        
        function checkStatus() {
            // V√©rifier API
            const apiKey = localStorage.getItem('tmdb_api_key');
            const apiStatus = document.getElementById('api-status');
            
            if (apiKey && apiKey.trim().length > 0) {
                apiStatus.textContent = '‚úÖ Configurada';
                apiStatus.classList.add('success');
            } else {
                apiStatus.textContent = '‚ùå N√£o configurada';
                apiStatus.classList.add('error');
                log('‚ùå API TMDB n√£o configurada. Configure em home.html primeiro.', 'error');
            }
            
            // V√©rifier donn√©es
            const dataStatus = document.getElementById('data-status');
            if (window.CATEGORIES_DATA) {
                dataStatus.textContent = '‚úÖ Carregadas';
                dataStatus.classList.add('success');
                
                // Compter les films
                let total = 0;
                Object.values(window.CATEGORIES_DATA).forEach(cat => {
                    total += cat.items.length;
                });
                
                document.getElementById('total-movies').textContent = total;
                stats.total = total;
                
                log(`‚úÖ ${total} filmes carregados de ${Object.keys(window.CATEGORIES_DATA).length} categorias`, 'success');
            } else {
                dataStatus.textContent = '‚ùå N√£o carregadas';
                dataStatus.classList.add('error');
                log('‚ùå Dados n√£o carregados', 'error');
            }
        }
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        async function startFullEnrichment() {
            const btn = document.getElementById('btn-enrich');
            btn.disabled = true;
            btn.classList.add('processing');
            
            log('üöÄ Iniciando enrichissement completo...', 'info');
            document.getElementById('progress-bar').classList.add('active');
            document.getElementById('stats-grid').style.display = 'grid';
            
            stats = { processed: 0, enriched: 0, failed: 0, total: stats.total };
            
            try {
                enrichedData = {};
                
                for (const [categoryKey, categoryData] of Object.entries(window.CATEGORIES_DATA)) {
                    log(`üìÅ Processando categoria: ${categoryData.title}`, 'info');
                    
                    enrichedData[categoryKey] = {
                        title: categoryData.title,
                        items: []
                    };
                    
                    for (const movie of categoryData.items) {
                        const enriched = await TMDB_ENRICHER.enrichMovie(movie);
                        enrichedData[categoryKey].items.push(enriched);
                        
                        stats.processed++;
                        if (enriched.tmdb_id) {
                            stats.enriched++;
                            log(`‚úÖ ${movie.title} enrichido com sucesso`, 'success');
                        } else {
                            stats.failed++;
                            log(`‚ö†Ô∏è ${movie.title} n√£o p√¥de ser enrichido`, 'warning');
                        }
                        
                        updateProgress();
                        await sleep(300); // Pause entre requ√™tes
                    }
                }
                
                log('‚ú® Enrichissement termin√©!', 'success');
                log(`üìä ${stats.enriched}/${stats.total} filmes enrichidos (${((stats.enriched/stats.total)*100).toFixed(1)}%)`, 'info');
                
                // Proposer de t√©l√©charger
                if (confirm('Enrichissement termin√©! Voulez-vous t√©l√©charger les donn√©es enrichies?')) {
                    downloadEnrichedData();
                }
                
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('processing');
            }
        }
        
        function updateProgress() {
            const percent = (stats.processed / stats.total * 100).toFixed(1);
            const fill = document.getElementById('progress-fill');
            fill.style.width = percent + '%';
            fill.textContent = percent + '%';
            
            document.getElementById('stat-processed').textContent = stats.processed;
            document.getElementById('stat-enriched').textContent = stats.enriched;
            document.getElementById('stat-failed').textContent = stats.failed;
            document.getElementById('stat-success').textContent = 
                ((stats.enriched / stats.processed * 100) || 0).toFixed(1) + '%';
        }
        
        function downloadEnrichedData() {
            if (!enrichedData) {
                alert('Nenhum dado enrichido dispon√≠vel!');
                return;
            }
            
            const content = `// Dados enrichidos automaticamente via TMDB API\n// Gerado em: ${new Date().toLocaleString()}\n\nwindow.CATEGORIES_DATA_ENRICHED = ${JSON.stringify(enrichedData, null, 2)};`;
            
            const blob = new Blob([content], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'categories-data-enriched.js';
            a.click();
            URL.revokeObjectURL(url);
            
            log('üíæ Arquivo baixado: categories-data-enriched.js', 'success');
        }
        
        async function showPreview() {
            log('üëÅÔ∏è Gerando pr√©-visualiza√ß√£o...', 'info');
            
            // Enrichir juste 2 films pour l'exemple
            const firstCategory = Object.values(window.CATEGORIES_DATA)[0];
            const testMovie = firstCategory.items[0];
            
            if (!TMDB_ENRICHER.init()) {
                log('‚ùå Imposs√≠vel gerar pr√©-visualiza√ß√£o sem API configurada', 'error');
                return;
            }
            
            const enriched = await TMDB_ENRICHER.enrichMovie(testMovie);
            
            console.log('üìã PR√â-VISUALIZA√á√ÉO:', enriched);
            log('‚úÖ Pr√©-visualiza√ß√£o gerada. Verifique o console do navegador.', 'success');
            alert('Pr√©-visualiza√ß√£o gerada! Abra o console do navegador (F12) para ver os detalhes.');
        }
        
        async function testSingleMovie() {
            const title = prompt('Digite o t√≠tulo do filme:');
            const year = prompt('Digite o ano:');
            
            if (!title || !year) return;
            
            log(`üß™ Testando: ${title} (${year})`, 'info');
            
            const result = await window.testOne(title, year);
            
            if (result && result.tmdb_id) {
                log(`‚úÖ Teste bem-sucedido! Verifique o console.`, 'success');
            } else {
                log(`‚ùå Filme n√£o encontrado`, 'error');
            }
        }
        
        function downloadSample() {
            const sample = {
                suspense: {
                    title: 'SUSPENSE',
                    items: [window.CATEGORIES_DATA.suspense.items[0]]
                }
            };
            
            const content = `// Exemplo de dado enrichido\nwindow.SAMPLE_ENRICHED = ${JSON.stringify(sample, null, 2)};`;
            
            const blob = new Blob([content], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample-enriched.js';
            a.click();
            URL.revokeObjectURL(url);
            
            log('üíæ Exemplo baixado', 'success');
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
