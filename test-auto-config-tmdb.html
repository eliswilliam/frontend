<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Auto-Config TMDB</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #fff;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    h1 {
      color: #6366f1;
      margin-bottom: 30px;
    }
    
    .test-section {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .test-section h2 {
      color: #fff;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status.success {
      background: #10b981;
      color: white;
    }
    
    .status.error {
      background: #ef4444;
      color: white;
    }
    
    .status.info {
      background: #3b82f6;
      color: white;
    }
    
    .result {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
    }
    
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin: 5px;
      transition: all 0.3s ease;
    }
    
    button:hover {
      background: #4f46e5;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }
    
    button.danger {
      background: #ef4444;
    }
    
    button.danger:hover {
      background: #dc2626;
    }
    
    .actions {
      margin-top: 20px;
    }
    
    code {
      background: rgba(99, 102, 241, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      color: #a5b4fc;
    }
  </style>
</head>
<body>
  <h1>üß™ Test Auto-Configuration TMDB</h1>
  
  <div class="test-section">
    <h2>
      üì¶ Script Carregado
      <span class="status" id="script-status">Verificando...</span>
    </h2>
    <div class="result" id="script-result"></div>
  </div>
  
  <div class="test-section">
    <h2>
      üîê Estado de Autentica√ß√£o
      <span class="status" id="auth-status">Verificando...</span>
    </h2>
    <div class="result" id="auth-result"></div>
  </div>
  
  <div class="test-section">
    <h2>
      üîë Cl√© API TMDB
      <span class="status" id="tmdb-status">Verificando...</span>
    </h2>
    <div class="result" id="tmdb-result"></div>
  </div>
  
  <div class="test-section">
    <h2>üìä Informa√ß√µes do Sistema</h2>
    <div class="result" id="system-info"></div>
  </div>
  
  <div class="actions">
    <h2>üé¨ A√ß√µes de Teste</h2>
    <button onclick="testAutoConfig()">Testar Auto-Configura√ß√£o</button>
    <button onclick="simulateLogin()">Simular Login</button>
    <button onclick="clearTMDB()" class="danger">Limpar TMDB</button>
    <button onclick="clearAll()" class="danger">Limpar Tudo</button>
    <button onclick="runAllTests()">Executar Todos os Testes</button>
  </div>
  
  <script src="auto-config-tmdb.js"></script>
  <script>
    // Fonction pour v√©rifier le script
    function checkScript() {
      const status = document.getElementById('script-status');
      const result = document.getElementById('script-result');
      
      if (typeof window.autoConfigureTMDB === 'function') {
        status.textContent = 'Carregado ‚úÖ';
        status.className = 'status success';
        result.innerHTML = `
          <div>‚úÖ Fun√ß√£o autoConfigureTMDB dispon√≠vel</div>
          <div>‚úÖ Script carregado com sucesso</div>
        `;
      } else {
        status.textContent = 'Erro ‚ùå';
        status.className = 'status error';
        result.innerHTML = `
          <div>‚ùå Fun√ß√£o autoConfigureTMDB n√£o encontrada</div>
          <div>‚ùå Verifique se o script est√° carregado</div>
        `;
      }
    }
    
    // Fonction pour v√©rifier l'authentification
    function checkAuth() {
      const status = document.getElementById('auth-status');
      const result = document.getElementById('auth-result');
      
      const token = localStorage.getItem('token');
      const email = localStorage.getItem('userEmail');
      
      if (token && email) {
        status.textContent = 'Autenticado ‚úÖ';
        status.className = 'status success';
        result.innerHTML = `
          <div>‚úÖ Token: ${token.substring(0, 20)}...</div>
          <div>‚úÖ Email: ${email}</div>
        `;
      } else {
        status.textContent = 'N√£o autenticado ‚ö†Ô∏è';
        status.className = 'status info';
        result.innerHTML = `
          <div>‚ö†Ô∏è Token: ${token || 'n√£o definido'}</div>
          <div>‚ö†Ô∏è Email: ${email || 'n√£o definido'}</div>
        `;
      }
    }
    
    // Fonction pour v√©rifier la cl√© TMDB
    function checkTMDB() {
      const status = document.getElementById('tmdb-status');
      const result = document.getElementById('tmdb-result');
      
      const apiKey = localStorage.getItem('tmdb_api_key');
      
      if (apiKey && apiKey.trim().length > 0) {
        status.textContent = 'Configurado ‚úÖ';
        status.className = 'status success';
        result.innerHTML = `
          <div>‚úÖ API Key: ${apiKey}</div>
          <div>‚úÖ Comprimento: ${apiKey.length} caracteres</div>
        `;
      } else {
        status.textContent = 'N√£o configurado ‚ö†Ô∏è';
        status.className = 'status info';
        result.innerHTML = `
          <div>‚ö†Ô∏è API Key n√£o configurada</div>
          <div>üí° Execute o auto-config ou fa√ßa login</div>
        `;
      }
    }
    
    // Fonction pour afficher les infos syst√®me
    function showSystemInfo() {
      const info = document.getElementById('system-info');
      const allKeys = Object.keys(localStorage);
      
      info.innerHTML = `
        <div><strong>Navegador:</strong> ${navigator.userAgent.split(' ').pop()}</div>
        <div><strong>URL:</strong> ${window.location.href}</div>
        <div><strong>LocalStorage Keys:</strong> ${allKeys.length}</div>
        <div><strong>Keys:</strong> ${allKeys.join(', ') || 'vazio'}</div>
      `;
    }
    
    // Actions de test
    function testAutoConfig() {
      console.log('üß™ Testando auto-configura√ß√£o...');
      if (typeof window.autoConfigureTMDB === 'function') {
        const result = window.autoConfigureTMDB();
        setTimeout(() => {
          checkTMDB();
          alert(result ? '‚úÖ Configura√ß√£o bem-sucedida!' : '‚ö†Ô∏è Usu√°rio n√£o autenticado ou j√° configurado');
        }, 100);
      } else {
        alert('‚ùå Fun√ß√£o autoConfigureTMDB n√£o dispon√≠vel');
      }
    }
    
    function simulateLogin() {
      console.log('üé≠ Simulando login...');
      localStorage.setItem('token', 'test_token_' + Date.now());
      localStorage.setItem('userEmail', 'test@example.com');
      
      // D√©clencher l'√©v√©nement
      window.dispatchEvent(new CustomEvent('user-logged-in', {
        detail: { email: 'test@example.com', token: 'test_token_' + Date.now() }
      }));
      
      setTimeout(() => {
        checkAuth();
        checkTMDB();
        alert('‚úÖ Login simulado! A API TMDB deve estar configurada agora.');
      }, 200);
    }
    
    function clearTMDB() {
      if (confirm('Remover apenas a configura√ß√£o TMDB?')) {
        localStorage.removeItem('tmdb_api_key');
        checkTMDB();
        alert('üóëÔ∏è Configura√ß√£o TMDB removida');
      }
    }
    
    function clearAll() {
      if (confirm('‚ö†Ô∏è Isso vai limpar TUDO do localStorage. Continuar?')) {
        localStorage.clear();
        checkAuth();
        checkTMDB();
        showSystemInfo();
        alert('üóëÔ∏è LocalStorage limpo completamente');
      }
    }
    
    function runAllTests() {
      console.log('üöÄ Executando todos os testes...');
      checkScript();
      checkAuth();
      checkTMDB();
      showSystemInfo();
      alert('‚úÖ Todos os testes executados! Verifique os resultados acima.');
    }
    
    // √âcouter les √©v√©nements
    window.addEventListener('tmdb-configured', function(e) {
      console.log('üéâ Evento tmdb-configured recebido:', e.detail);
      alert('üéâ TMDB configurado via evento!');
      checkTMDB();
    });
    
    window.addEventListener('user-logged-in', function(e) {
      console.log('üîê Evento user-logged-in recebido:', e.detail);
    });
    
    // Initialisation
    window.addEventListener('load', function() {
      checkScript();
      checkAuth();
      checkTMDB();
      showSystemInfo();
    });
  </script>
</body>
</html>
