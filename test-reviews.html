<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Reviews - CINEMAF</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        button {
            background: #e50914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #f40612;
        }
        .result {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #000;
            color: #fff;
            border: 1px solid #555;
            border-radius: 5px;
        }
        .star-rating {
            font-size: 30px;
            color: #FFD700;
        }
        .star {
            cursor: pointer;
            transition: all 0.2s;
        }
        .star:hover {
            transform: scale(1.2);
        }
        .success { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>
    <h1>üé¨ Teste de Sistema de Reviews - CINEMAF</h1>
    
    <div class="test-section">
        <h2>üì° Teste 1: Conex√£o com Backend</h2>
        <p>URL da API: <span id="api-url"></span></p>
        <button onclick="testConnection()">Testar Conex√£o</button>
        <div class="result" id="connection-result"></div>
    </div>

    <div class="test-section">
        <h2>‚≠ê Teste 2: Criar Nova Avalia√ß√£o</h2>
        <label>Movie ID:</label>
        <input type="text" id="movieId" value="533535" placeholder="Ex: 533535">
        
        <label>Nome de Usu√°rio:</label>
        <input type="text" id="username" value="TestUser" placeholder="Seu nome">
        
        <label>Nota (1-5):</label>
        <div class="star-rating" id="star-rating">
            <span class="star" data-value="1" onclick="setRating(1)">‚òÜ</span>
            <span class="star" data-value="2" onclick="setRating(2)">‚òÜ</span>
            <span class="star" data-value="3" onclick="setRating(3)">‚òÜ</span>
            <span class="star" data-value="4" onclick="setRating(4)">‚òÜ</span>
            <span class="star" data-value="5" onclick="setRating(5)">‚òÜ</span>
        </div>
        <input type="hidden" id="rating" value="0">
        
        <label>Coment√°rio:</label>
        <textarea id="comment" rows="4" placeholder="Escreva sua avalia√ß√£o aqui...">Filme incr√≠vel! Adorei a hist√≥ria e as atua√ß√µes.</textarea>
        
        <button onclick="createReview()">Criar Avalia√ß√£o</button>
        <div class="result" id="create-result"></div>
    </div>

    <div class="test-section">
        <h2>üìã Teste 3: Buscar Avalia√ß√µes de um Filme</h2>
        <label>Movie ID:</label>
        <input type="text" id="getMovieId" value="533535" placeholder="Ex: 533535">
        <button onclick="getReviews()">Buscar Avalia√ß√µes</button>
        <div class="result" id="get-result"></div>
    </div>

    <div class="test-section">
        <h2>üìä Teste 4: Estat√≠sticas do Filme</h2>
        <label>Movie ID:</label>
        <input type="text" id="statsMovieId" value="533535" placeholder="Ex: 533535">
        <button onclick="getStats()">Buscar Estat√≠sticas</button>
        <div class="result" id="stats-result"></div>
    </div>

    <script>
        // Configura√ß√£o da API - D√©tection automatique de l'environnement
        function getApiBaseUrl() {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3001/api/reviews';
            }
            return 'https://cinemaf.onrender.com/api/reviews';
        }
        
        const API_BASE_URL = getApiBaseUrl();
        document.getElementById('api-url').textContent = API_BASE_URL;
        
        console.log('üåê Environnement d√©tect√©:', window.location.hostname);
        console.log('üîó URL API utilis√©e:', API_BASE_URL);

        let currentRating = 0;

        function setRating(rating) {
            currentRating = rating;
            document.getElementById('rating').value = rating;
            
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.textContent = '‚òÖ';
                } else {
                    star.textContent = '‚òÜ';
                }
            });
        }

        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '‚è≥ Testando conex√£o...';
            
            try {
                const response = await fetch('http://localhost:3001/health');
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">‚úÖ Conex√£o OK!</span>\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro de conex√£o:</span>\n${error.message}`;
            }
        }

        async function createReview() {
            const resultDiv = document.getElementById('create-result');
            resultDiv.innerHTML = '‚è≥ Criando avalia√ß√£o...';
            
            const movieId = document.getElementById('movieId').value;
            const username = document.getElementById('username').value;
            const rating = parseInt(document.getElementById('rating').value);
            const comment = document.getElementById('comment').value;

            if (!movieId || !username || !rating || !comment) {
                resultDiv.innerHTML = '<span class="error">‚ùå Preencha todos os campos!</span>';
                return;
            }

            if (rating < 1 || rating > 5) {
                resultDiv.innerHTML = '<span class="error">‚ùå Selecione uma nota de 1 a 5!</span>';
                return;
            }

            try {
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        movieId,
                        username,
                        rating,
                        comment
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ Avalia√ß√£o criada com sucesso!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå Erro:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro ao criar avalia√ß√£o:</span>\n${error.message}`;
            }
        }

        async function getReviews() {
            const resultDiv = document.getElementById('get-result');
            resultDiv.innerHTML = '‚è≥ Buscando avalia√ß√µes...';
            
            const movieId = document.getElementById('getMovieId').value;

            if (!movieId) {
                resultDiv.innerHTML = '<span class="error">‚ùå Digite um Movie ID!</span>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${movieId}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ ${data.count} avalia√ß√µes encontradas!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå Erro:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro ao buscar avalia√ß√µes:</span>\n${error.message}`;
            }
        }

        async function getStats() {
            const resultDiv = document.getElementById('stats-result');
            resultDiv.innerHTML = '‚è≥ Buscando estat√≠sticas...';
            
            const movieId = document.getElementById('statsMovieId').value;

            if (!movieId) {
                resultDiv.innerHTML = '<span class="error">‚ùå Digite um Movie ID!</span>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${movieId}/stats`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">‚úÖ Estat√≠sticas carregadas!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå Erro:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro ao buscar estat√≠sticas:</span>\n${error.message}`;
            }
        }

        // Testar conex√£o automaticamente ao carregar
        window.addEventListener('load', () => {
            console.log('üöÄ P√°gina de teste carregada');
            console.log('üåê API URL:', API_BASE_URL);
        });
    </script>
</body>
</html>
