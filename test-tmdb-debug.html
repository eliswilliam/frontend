<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMDB Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success { color: #4ade80; }
        .error { color: #ef4444; }
        .warning { color: #fbbf24; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        input {
            padding: 10px;
            width: 400px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
        }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <h1>üîç TMDB API - Teste de Diagn√≥stico</h1>
    
    <div class="section">
        <h2>1Ô∏è‚É£ Verificar LocalStorage</h2>
        <button onclick="checkLocalStorage()">Verificar Chave API</button>
        <div id="localStorage-result"></div>
    </div>

    <div class="section">
        <h2>2Ô∏è‚É£ Configurar Chave API</h2>
        <input type="text" id="api-key-input" placeholder="Cole sua chave TMDB API aqui">
        <button onclick="saveApiKey()">Salvar Chave</button>
        <button onclick="clearApiKey()">Limpar Chave</button>
        <div id="save-result"></div>
    </div>

    <div class="section">
        <h2>3Ô∏è‚É£ Testar Busca de Filme</h2>
        <input type="text" id="search-input" placeholder="Digite o nome do filme" value="test">
        <button onclick="testSearch()">Buscar Filme</button>
        <div id="search-result"></div>
    </div>

    <div class="section">
        <h2>4Ô∏è‚É£ Testar Detalhes do Filme</h2>
        <input type="text" id="movie-id-input" placeholder="ID do filme TMDB" value="1244039">
        <button onclick="testMovieDetails()">Buscar Detalhes</button>
        <div id="details-result"></div>
    </div>

    <script>
        function checkLocalStorage() {
            const apiKey = localStorage.getItem('tmdb_api_key');
            const result = document.getElementById('localStorage-result');
            
            if (apiKey && apiKey.trim().length > 0) {
                result.innerHTML = `
                    <p class="success">‚úÖ Chave API encontrada!</p>
                    <p>Chave: ${apiKey.substring(0, 10)}...${apiKey.substring(apiKey.length - 5)}</p>
                    <p>Comprimento: ${apiKey.length} caracteres</p>
                `;
            } else {
                result.innerHTML = `
                    <p class="error">‚ùå Nenhuma chave API encontrada no localStorage</p>
                    <p class="warning">‚ö†Ô∏è Configure sua chave API na se√ß√£o 2</p>
                `;
            }
        }

        function saveApiKey() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            const result = document.getElementById('save-result');
            
            if (apiKey.length === 0) {
                result.innerHTML = '<p class="error">‚ùå Por favor, insira uma chave API v√°lida</p>';
                return;
            }
            
            localStorage.setItem('tmdb_api_key', apiKey);
            result.innerHTML = `
                <p class="success">‚úÖ Chave API salva com sucesso!</p>
                <p>Agora teste a busca na se√ß√£o 3</p>
            `;
            
            // Atualizar verifica√ß√£o
            checkLocalStorage();
        }

        function clearApiKey() {
            localStorage.removeItem('tmdb_api_key');
            document.getElementById('save-result').innerHTML = '<p class="warning">üóëÔ∏è Chave API removida</p>';
            document.getElementById('api-key-input').value = '';
            checkLocalStorage();
        }

        async function testSearch() {
            const query = document.getElementById('search-input').value.trim();
            const apiKey = localStorage.getItem('tmdb_api_key');
            const result = document.getElementById('search-result');
            
            if (!apiKey) {
                result.innerHTML = '<p class="error">‚ùå Configure a chave API primeiro (se√ß√£o 2)</p>';
                return;
            }
            
            if (query.length === 0) {
                result.innerHTML = '<p class="error">‚ùå Digite um termo de busca</p>';
                return;
            }
            
            result.innerHTML = '<p class="warning">üîÑ Buscando...</p>';
            
            try {
                const url = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=pt-BR&page=1`;
                console.log('üåê URL da requisi√ß√£o:', url);
                
                const response = await fetch(url);
                
                console.log('üì° Status da resposta:', response.status);
                
                if (!response.ok) {
                    result.innerHTML = `<p class="error">‚ùå Erro na API: ${response.status} ${response.statusText}</p>`;
                    return;
                }
                
                const data = await response.json();
                console.log('üì¶ Dados recebidos:', data);
                
                if (data.results && data.results.length > 0) {
                    const movies = data.results.slice(0, 5).map(m => 
                        `<li><strong>${m.title}</strong> (${m.release_date?.split('-')[0] || 'N/A'}) - ID: ${m.id}</li>`
                    ).join('');
                    
                    result.innerHTML = `
                        <p class="success">‚úÖ ${data.results.length} filmes encontrados!</p>
                        <p><strong>Primeiros 5 resultados:</strong></p>
                        <ul>${movies}</ul>
                    `;
                } else {
                    result.innerHTML = '<p class="warning">‚ö†Ô∏è Nenhum filme encontrado</p>';
                }
            } catch (error) {
                console.error('‚ùå Erro na busca:', error);
                result.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        }

        async function testMovieDetails() {
            const movieId = document.getElementById('movie-id-input').value.trim();
            const apiKey = localStorage.getItem('tmdb_api_key');
            const result = document.getElementById('details-result');
            
            if (!apiKey) {
                result.innerHTML = '<p class="error">‚ùå Configure a chave API primeiro (se√ß√£o 2)</p>';
                return;
            }
            
            if (movieId.length === 0) {
                result.innerHTML = '<p class="error">‚ùå Digite um ID de filme</p>';
                return;
            }
            
            result.innerHTML = '<p class="warning">üîÑ Carregando detalhes...</p>';
            
            try {
                const url = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}&language=pt-BR&append_to_response=credits,videos,similar`;
                console.log('üåê URL da requisi√ß√£o:', url);
                
                const response = await fetch(url);
                
                console.log('üì° Status da resposta:', response.status);
                
                if (!response.ok) {
                    result.innerHTML = `<p class="error">‚ùå Erro na API: ${response.status} ${response.statusText}</p>`;
                    return;
                }
                
                const data = await response.json();
                console.log('üì¶ Dados completos do filme:', data);
                
                // Extrair informa√ß√µes importantes
                const director = data.credits?.crew?.find(c => c.job === 'Director')?.name || 'N/A';
                const trailer = data.videos?.results?.find(v => v.type === 'Trailer' && v.site === 'YouTube');
                
                result.innerHTML = `
                    <p class="success">‚úÖ Detalhes carregados com sucesso!</p>
                    <div style="margin-top: 15px;">
                        <p><strong>T√≠tulo:</strong> ${data.title}</p>
                        <p><strong>T√≠tulo Original:</strong> ${data.original_title}</p>
                        <p><strong>Ano:</strong> ${data.release_date?.split('-')[0] || 'N/A'}</p>
                        <p><strong>Diretor:</strong> ${director}</p>
                        <p><strong>Avalia√ß√£o:</strong> ${data.vote_average?.toFixed(1) || 'N/A'}/10</p>
                        <p><strong>Dura√ß√£o:</strong> ${data.runtime ? Math.floor(data.runtime / 60) + 'h ' + (data.runtime % 60) + 'm' : 'N/A'}</p>
                        <p><strong>Or√ßamento:</strong> ${data.budget ? '$' + data.budget.toLocaleString() : 'N/A'}</p>
                        <p><strong>Receita:</strong> ${data.revenue ? '$' + data.revenue.toLocaleString() : 'N/A'}</p>
                        <p><strong>Trailer:</strong> ${trailer ? '‚úÖ Dispon√≠vel (YouTube ID: ' + trailer.key + ')' : '‚ùå N√£o dispon√≠vel'}</p>
                        <p><strong>Sinopse:</strong> ${data.overview || 'N/A'}</p>
                    </div>
                    <details>
                        <summary style="cursor: pointer; margin-top: 10px;">Ver JSON completo</summary>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;
            } catch (error) {
                console.error('‚ùå Erro ao carregar detalhes:', error);
                result.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        }

        // Verificar automaticamente ao carregar a p√°gina
        window.onload = () => {
            checkLocalStorage();
        };
    </script>
</body>
</html>
