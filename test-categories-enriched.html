<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Categories Enrichment</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .status {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .movie-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .movie-poster {
            width: 100%;
            height: 400px;
            object-fit: cover;
        }
        
        .movie-info {
            padding: 15px;
        }
        
        .movie-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .movie-meta {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .movie-enriched {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        
        .movie-enriched h4 {
            margin: 0 0 5px 0;
            color: #10b981;
        }
        
        .movie-enriched ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.5em;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .category-section {
            margin-bottom: 50px;
        }
        
        .category-title {
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid rgba(255,255,255,0.3);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            display: block;
        }
        
        .stat-label {
            opacity: 0.8;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Test d'Enrichissement des Cat√©gories</h1>
        
        <div class="controls">
            <div class="status" id="status">
                ‚è≥ Chargement...
            </div>
            
            <div class="stats" id="stats" style="display: none;">
                <div class="stat-box">
                    <span class="stat-value" id="stat-total">0</span>
                    <span class="stat-label">Films Total</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="stat-enriched">0</span>
                    <span class="stat-label">Enrichis</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="stat-cached">0</span>
                    <span class="stat-label">En Cache</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="stat-percent">0%</span>
                    <span class="stat-label">Taux Enrichissement</span>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn-primary" onclick="loadCategory('suspense')">
                    üîç Charger SUSPENSE
                </button>
                <button class="btn-primary" onclick="loadCategory('comedia')">
                    üòÇ Charger COM√âDIA
                </button>
                <button class="btn-primary" onclick="loadCategory('acao')">
                    üí• Charger A√á√ÉO
                </button>
                <button class="btn-success" onclick="loadAllCategories()">
                    ‚ö° Charger TOUT
                </button>
                <button class="btn-info" onclick="showCacheStats()">
                    üìä Stats Cache
                </button>
                <button class="btn-danger" onclick="clearCache()">
                    üóëÔ∏è Vider Cache
                </button>
            </div>
        </div>
        
        <div id="content"></div>
    </div>

    <script src="categories-data.js"></script>
    <script src="categories-tmdb-manager.js"></script>
    <script>
        let enrichedData = {};
        let stats = {
            total: 0,
            enriched: 0,
            cached: 0
        };
        
        // Initialisation
        window.addEventListener('load', () => {
            updateStatus('‚úÖ Pr√™t! S√©lectionnez une cat√©gorie √† charger.');
            countTotalMovies();
        });
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function countTotalMovies() {
            let total = 0;
            Object.values(window.CATEGORIES_DATA).forEach(cat => {
                total += cat.items.length;
            });
            stats.total = total;
            document.getElementById('stat-total').textContent = total;
        }
        
        async function loadCategory(categoryKey) {
            updateStatus(`‚è≥ Chargement de ${categoryKey.toUpperCase()}...`);
            document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div><br>Enrichissement en cours...</div>';
            
            const categoryData = window.CATEGORIES_DATA[categoryKey];
            
            if (!categoryData) {
                updateStatus('‚ùå Cat√©gorie non trouv√©e!');
                return;
            }
            
            try {
                const enriched = await CategoriesTMDBManager.enrichCategory(categoryData);
                enrichedData[categoryKey] = enriched;
                
                displayCategory(categoryKey, enriched);
                updateStats();
                updateStatus(`‚úÖ ${categoryKey.toUpperCase()} charg√© avec succ√®s!`);
                
            } catch (error) {
                updateStatus(`‚ùå Erreur: ${error.message}`);
                console.error(error);
            }
        }
        
        async function loadAllCategories() {
            updateStatus('‚è≥ Chargement de TOUTES les cat√©gories...');
            document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div><br>Enrichissement de toutes les cat√©gories...</div>';
            
            try {
                enrichedData = await CategoriesTMDBManager.enrichCategories(window.CATEGORIES_DATA);
                
                displayAllCategories();
                updateStats();
                updateStatus('‚úÖ Toutes les cat√©gories charg√©es!');
                
            } catch (error) {
                updateStatus(`‚ùå Erreur: ${error.message}`);
                console.error(error);
            }
        }
        
        function displayCategory(categoryKey, categoryData) {
            const content = document.getElementById('content');
            
            let html = `
                <div class="category-section">
                    <h2 class="category-title">${categoryData.title}</h2>
                    <div class="movies-grid">
            `;
            
            categoryData.items.forEach(movie => {
                html += createMovieCard(movie);
            });
            
            html += `
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        function displayAllCategories() {
            const content = document.getElementById('content');
            let html = '';
            
            for (const [categoryKey, categoryData] of Object.entries(enrichedData)) {
                html += `
                    <div class="category-section">
                        <h2 class="category-title">${categoryData.title}</h2>
                        <div class="movies-grid">
                `;
                
                categoryData.items.forEach(movie => {
                    html += createMovieCard(movie);
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = html;
        }
        
        function createMovieCard(movie) {
            const isEnriched = !!movie.tmdb_id;
            
            let enrichedInfo = '';
            if (isEnriched) {
                stats.enriched++;
                
                enrichedInfo = `
                    <div class="movie-enriched">
                        <h4>‚ú® Donn√©es Enrichies TMDB</h4>
                        <strong>ID:</strong> ${movie.tmdb_id}<br>
                        <strong>Dur√©e:</strong> ${movie.runtime || 'N/A'} min<br>
                        <strong>Note:</strong> ‚≠ê ${movie.vote_average?.toFixed(1) || movie.rating}/10<br>
                        <strong>Genres:</strong> ${movie.genres?.join(', ') || 'N/A'}<br>
                        ${movie.director ? `<strong>R√©alisateur:</strong> ${movie.director}<br>` : ''}
                        ${movie.cast?.length > 0 ? `<strong>Cast:</strong><ul>${movie.cast.slice(0, 3).map(c => `<li>${c.name} (${c.character})</li>`).join('')}</ul>` : ''}
                        ${movie.trailer ? `<strong>Trailer:</strong> <a href="https://youtube.com/watch?v=${movie.trailer}" target="_blank" style="color: #10b981;">‚ñ∂Ô∏è Voir</a>` : ''}
                    </div>
                `;
            }
            
            return `
                <div class="movie-card" ${isEnriched ? 'style="border: 2px solid #10b981;"' : ''}>
                    <img class="movie-poster" src="${movie.image}" alt="${movie.title}" onerror="this.src='https://via.placeholder.com/280x400?text=Pas+d%27image'">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title} ${isEnriched ? '‚ú®' : ''}</div>
                        <div class="movie-meta">
                            üìÖ ${movie.year} | ‚≠ê ${movie.rating}
                        </div>
                        <p style="font-size: 0.9em; opacity: 0.9;">${movie.description}</p>
                        ${enrichedInfo}
                    </div>
                </div>
            `;
        }
        
        function updateStats() {
            const cacheStats = CategoriesTMDBManager.getCacheStats();
            stats.cached = cacheStats.size;
            
            document.getElementById('stats').style.display = 'grid';
            document.getElementById('stat-enriched').textContent = stats.enriched;
            document.getElementById('stat-cached').textContent = stats.cached;
            document.getElementById('stat-percent').textContent = 
                stats.total > 0 ? ((stats.enriched / stats.total * 100).toFixed(1) + '%') : '0%';
        }
        
        function showCacheStats() {
            const stats = CategoriesTMDBManager.getCacheStats();
            alert(`üìä Statistiques du Cache\n\n` +
                  `Films en cache: ${stats.size}\n` +
                  `Cl√©s: ${stats.keys.slice(0, 5).join(', ')}${stats.size > 5 ? '...' : ''}`);
        }
        
        function clearCache() {
            if (confirm('√ätes-vous s√ªr de vouloir vider le cache?\nCela supprimera toutes les donn√©es TMDB sauvegard√©es.')) {
                CategoriesTMDBManager.clearCache();
                stats.cached = 0;
                updateStats();
                updateStatus('üóëÔ∏è Cache vid√©!');
            }
        }
    </script>
</body>
</html>
